---
title: "to_json: Pandoc to JSON string conversion within Lua filters"
author: "Julien Dutant"
---

To_json: Pandoc to JSON string conversion within Lua filters
=======

Pandoc Lua filters](https://pandoc.org/lua-filters.html) function to covert 
a Pandoc object to a native JSON representation string.

*Requirements*. Perl. Installed by default on most systems; you can check that
it is by running `perl -v` on the command line.

Description
------------

In [Pandoc Lua filters](https://pandoc.org/lua-filters.html), it would sometimes
be useful to be able to convert various Pandoc elements (Para, Str, etc.) to
their native JSON representation. This function does it for entire Pandoc
document objects. 

Why have this? On the command line, we can convert documents to Pandoc's native
JSON representation with `pandoc --to json`. Within a filter, we can convert
files(and strings in some raw format) to Pandoc's native JSON representation
with `pandoc.pipe('pandoc', {"-f", "<format>"}, string)`. But suppose your
filter `myfilter` has been launched by the following command:

```bash 
pandoc -L previous-filters.lua -L myfilter.lua source.md -o output.pdf
```

When this command is run, Pandoc first converts source.md to an Pandoc object
(with Pandoc AST elements like Para, Str etc.). Then it applies the previous
filters to that object, and then passes it to the filter. Now suppose your
filter needs a JSON representation of parts of the document, 
*including any modification generated by previous filters*. Your filter can't
simply use `pandoc.pipe('pandoc',...)` on `source.md`, for that would ignore
any modification introduced by `previous-filters.lua`. Rather, you want to 
convert the *current* Pandoc object to its native JSON representation so that
you can run Pandoc on it externally with `pandoc.pipe('pandoc',...)` or
`os.execute`. 

Example use cases:

* You're writing a filter that, when used, will generate outputs for sub-parts
  of the document as well as the entire document. 
* You're writing a filter that generates series of documents from a single
  source document: say, letters from a list of names, randomized orders for a 
  list of questions. 

Usage
-----

Copy the function `to_json` (in `to_json.lua`) in your filter.

The file `to_json.lua` can be used as a filter to demonstrate the function. 
Run:

```bash
pandoc -L to_json sample.file
```

Prints out the native JSON representation of `sample.file`. It should give you
the same output as `pandoc -to json sample.file`. 

Note
----

`perlsandbox.pl` is not needed to run the filter. We use it to test
the filter's perl commands that wrap a string within a native JSON representation. Run `perlsandbox.pl | pandoc -f json -t markdown` to see if Pandoc can read the string produced. 

Developments
------------

* The function should handle not only elements of the Pandoc type, but other
  elements types (incl Meta, MetaList etc., but not components).