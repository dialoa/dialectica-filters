---
title: "Prefix-ids: add prefix to all identifiers in Pandoc document"
author: "Julien Dutant"
---

Prefix-ids
==========

Add prefix to all identifiers in Pandoc document

v0.1. Copyright: Â© 2021 Julien Dutant <julien.dutant@kcl.ac.uk>
License:  MIT - see LICENSE file for details.

Description
------------

Internal links within a Pandoc document, including those 
generated by citations with Citeproc, rely on identifiers. 
To avoid clashes when several documents are put together,
this filter:

1. adds a custom (or random) prefix to
all elements with an identifier within a document's body
2. fixes any internal links using those identifiers

It is best used after filters that add or modify links. 

*Note*. 

Usage
-----

The filter is loaded with the Pandoc `-L` or `--lua-filter` option. 

```bash 
pandoc -L path/to/prefix-ids.lua source.md -o output.html
```

If the filter is in Pandoc's `$DATADIR` there is no need to give its
path. See [Pandoc's manual[
(https://pandoc.org/MANUAL.html#general-options) for details.

A custom prefix can be specified in the document metadata:

```yaml
prefix-ids:
  prefix: 'my prefix'
```

If no prefix is specified, the filter will use a random 40-char string
of letters and numbers (`sha1` of the document's body).

Warning
-------

The filter doesn't handle identifiers and links situated in the 
document's metadata, e.g. in the `abstract` or `thanks` field.

Note
----

Pandoc's [`id_prefix` option](https://pandoc.org/MANUAL.html#option--id-prefix)
does something similar but only for HTML and DocBook output. 
This filter applies the prefix within the Pandoc AST
document, making it suitable for inclusion within wider
pandoc documents, directly or via json output.